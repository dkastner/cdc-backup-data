/*!
* @fileOverview A jQuery-based class to support the display of real-time Facebook and Twitter feeds.
* @description This is a library utilizing jQuery JSONP AJAX calls to request JSON serialized Atom feeds
* that are requested directly from Facebook and Twitter via an application that "proxies" the feed.
* 
* @requires jQuery CORE
*						Server-side feed generator that supports JSONP
* @version 1.0.0.0
*/
function feedDefinition(feedId,url,title,numberOfItems,enabled){this.feedId=feedId;this.url=url;this.title=title;this.numberOfItems=numberOfItems;this.enabled=enabled}if(typeof CDC=="undefined")var CDC=new Object;if(typeof CDC.SocialMedia=="undefined")CDC.SocialMedia=new Object;if(typeof CDC.SocialMedia.Feeds=="undefined")CDC.SocialMedia.Feeds=new Object;CDC.SocialMedia.Feeds=function(){return{FEED_URL_PREFIX:"http://www2c.cdc.gov/podcasts/feed.asp",FEED_ID_PARAM:"feedid",SOCIAL_MEDIA_FEEDS_DIV_ID:"socialMediaFeeds",TWITTER_DIV_ID:"tweet",FACEBOOK_DIV_ID:"facebook",LOADER_GRAPHIC:"div.socl-loader-graphic",FEED_ITEM_BLOCK:"div.socl-comment-text",FEED_ITEM_POSTS:this.FEED_ITEM_BLOCK+" p",FAILOVER_ANCHOR:this.FEED_ITEM_BLOCK+" a.failover",linkify:function(text){var urlPattern=/\b(?:https?):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim;return text.replace(urlPattern,'<a href="$&" target="_blank">$&</a>')}}}();CDC.SocialMedia.Feeds.Twitter=function(feedDefinitionArray,moduleId,twitterDivId){this.feedDefinitionArray=feedDefinitionArray;this.moduleId=typeof moduleId=="undefined"?CDC.SocialMedia.Feeds.SOCIAL_MEDIA_FEEDS_DIV_ID:moduleId;this.twitterDivId=typeof twitterDivId=="undefined"?CDC.SocialMedia.Feeds.TWITTER_DIV_ID:twitterDivId;AjaxMethod=function(feedDef,feedIndex,firstFeed,lastFeed,moduleId,twitterDivId){this.feedDef=feedDef;this.feedIndex=feedIndex;this.firstFeed=firstFeed;this.lastFeed=lastFeed;this.moduleId=moduleId;this.twitterDivId=twitterDivId;this.tagId=this.moduleId+" "+this.twitterDivId+" "};Placeholder=function(token,value){this.token=token;this.value=value};AjaxMethod.prototype={render:function(){if(this.feedDef.enabled&&$.support.ajax&&!(navigator.platform=="BlackBerry"&&navigator.appVersion.substring(0,6)=="5.0.0.")){if(this.firstFeed){$(this.tagId+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","block")}$.getJSON(CDC.SocialMedia.Feeds.FEED_URL_PREFIX+"?"+CDC.SocialMedia.Feeds.FEED_ID_PARAM+"="+this.feedDef.feedId+"&format=json&callback=?",function(fd,tagId,ff,lf){var ti=tagId;return function(data){try{var newId="item-tweet-"+fd.feedId;var newItem=$("#"+newId);if(data.statuses){var i=0;var numberFound=0;while(numberFound<fd.numberOfItems&&i<data.statuses.length){if(data.statuses[i].text!=""){var tweetText=data.statuses[i].text;var substitutions=new Array;var substitutionsIndex=0;var tokenText="";var tokenStart=0;var tokenEnd=0;var placeholderText="";var placeholderSize=0;if(data.statuses[i].entities&&data.statuses[i].entities.urls){for(var j=0;j<data.statuses[i].entities.urls.length;j++){if(data.statuses[i].entities.urls[j].expanded_url&&data.statuses[i].entities.urls[j].expanded_url.length>0){tokenText=data.statuses[i].entities.urls[j].url;tokenStart=data.statuses[i].entities.urls[j].indices[0];tokenEnd=data.statuses[i].entities.urls[j].indices[1];placeholderSize=tokenText.length-2;if(placeholderSize>0){placeholderText="|"+Array(placeholderSize+1).join(substitutionsIndex.toString())+"|";substitutions[substitutionsIndex++]=new Placeholder(placeholderText,'&lt;a href="'+data.statuses[i].entities.urls[j].expanded_url+'"&gt;'+tokenText+"&lt;/a&gt;");tweetText=tweetText.substring(0,tokenStart)+placeholderText+tweetText.substring(tokenEnd)}}}}if(data.statuses[i].entities&&data.statuses[i].entities.hashtags){for(var j=0;j<data.statuses[i].entities.hashtags.length;j++){tokenText=data.statuses[i].entities.hashtags[j].text;tokenStart=data.statuses[i].entities.hashtags[j].indices[0];tokenEnd=data.statuses[i].entities.hashtags[j].indices[1];placeholderSize=tokenText.length-2;if(placeholderSize>0){placeholderText="|"+Array(placeholderSize+1).join(substitutionsIndex.toString())+"|";substitutions[substitutionsIndex++]=new Placeholder(placeholderText,'&lt;a href="https://twitter.com/search?q=%23'+tokenText+'&src=hash"&gt;'+tokenText+"&lt;/a&gt;");tweetText=tweetText.substring(0,tokenStart+1)+placeholderText+tweetText.substring(tokenEnd)}}}if(data.statuses[i].entities&&data.statuses[i].entities.user_mentions){for(var j=0;j<data.statuses[i].entities.user_mentions.length;j++){tokenText=data.statuses[i].entities.user_mentions[j].screen_name;tokenStart=data.statuses[i].entities.user_mentions[j].indices[0];tokenEnd=data.statuses[i].entities.user_mentions[j].indices[1];placeholderSize=tokenText.length-2;if(placeholderSize>0){placeholderText="|"+Array(placeholderSize+1).join(substitutionsIndex.toString())+"|";substitutions[substitutionsIndex++]=new Placeholder(placeholderText,'&lt;a href="https://twitter.com/'+tokenText+'"&gt;'+tokenText+"&lt;/a&gt;");tweetText=tweetText.substring(0,tokenStart+1)+placeholderText+tweetText.substring(tokenEnd)}}}for(var k=0;k<substitutions.length;k++){tweetText=tweetText.replace(substitutions[k].token,substitutions[k].value)}if(numberFound<fd.numberOfItems-1){newItem.html(newItem.html()+'<div class="feed-item">'+$('<div style="display: none;"/>').html(tweetText).text().replace(/\<\/?em\>/g,"")+"</div>")}else{newItem.html(newItem.html()+'<div class="feed-item lastChild">'+$('<div style="display: none;"/>').html(tweetText).text().replace(/\<\/?em\>/g,"")+"</div>")}newItem.find("a").each(function(){var target=$(this).prop("href");var linkText=$(this).html();if(target.indexOf("http://twitter.com")==0){$(this).prop("href",target.replace("http://twitter.com","https://twitter.com"))}else if(target.indexOf("http://search.twitter.com/search")==0){$(this).prop("href",target.replace("http://search.twitter.com/search","https://twitter.com/search"))}else if(target.indexOf("/")==0){$(this).prop("href","https://twitter.com"+target)}$(this).html(linkText)});numberFound++}i++}var block=$("#item-twitter-profile-"+fd.feedId);block.append(newItem);$("#"+newId).fadeIn(400,function(){});if(lf){$(ti+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none");$(ti+CDC.SocialMedia.Feeds.FAILOVER_ANCHOR).css("display","none")}}else{if(lf){$("div#tweet div.socl-loader-graphic").css("display","none");$("div#tweet div.socl-comment-text a.failover").css("display","block");$("#item-twitter-profile-"+fd.feedId+" a.socl-user").hide()}}}catch(err){if(lf){$(ti+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none");$(ti+CDC.SocialMedia.Feeds.FAILOVER_ANCHOR).css("display","block")}}}}(this.feedDef,this.tagId,this.firstFeed,this.lastFeed)).error(function(){if(this.lastFeed){$(this.tagId+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none");$(this.tagId+CDC.SocialMedia.Feeds.FAILOVER_ANCHOR).css("display","block")}})}else if(this.feedDef.enabled&&navigator.platform=="BlackBerry"&&navigator.appVersion.substring(0,6)=="5.0.0."){$(this.tagId+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none");$(this.tagId+CDC.SocialMedia.Feeds.FAILOVER_ANCHOR).css("display","block")}else{if(this.lastFeed){$(this.tagId+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none");$(this.tagId+CDC.SocialMedia.Feeds.FEED_ITEM_POSTS).css("display","block")}}}};return{render:function(){var firstFeed=true;var lastFeed=true;var moduleId;var twitterDivId;if(typeof this.moduleId=="undefined"){moduleId="#"+CDC.SocialMedia.Feeds.SOCIAL_MEDIA_FEEDS_DIV_ID}else if(this.moduleId.substring(0,1)!="#"){moduleId="#"+this.moduleId}if(typeof this.twitterDivId=="undefined"){twitterDivId="#"+CDC.SocialMedia.Feeds.TWITTER_DIV_ID}else if(this.twitterDivId.substring(0,1)!="#"){twitterDivId="#"+this.twitterDivId}var tagId=moduleId+" "+twitterDivId+" ";for(var i=0;i<feedDefinitionArray.length;i++){var placeholder=$('<div id="item-twitter-profile-'+feedDefinitionArray[i].feedId+'" />');$(tagId+CDC.SocialMedia.Feeds.FEED_ITEM_BLOCK).append(placeholder);var newId="item-tweet-"+feedDefinitionArray[i].feedId;var block=$(tagId+CDC.SocialMedia.Feeds.FEED_ITEM_BLOCK);var newItem=$('<p id="'+newId+'" style="display: none;" />');var cdcGovHeader=$('<a class="socl-user noLinking" href="'+feedDefinitionArray[i].url+'" target="_blank">'+feedDefinitionArray[i].title+"</a>");placeholder.append(newItem);placeholder.append(cdcGovHeader)}for(var i=0;i<feedDefinitionArray.length;i++){firstFeed=i==0;lastFeed=i==feedDefinitionArray.length-1;var theFeed=new AjaxMethod(feedDefinitionArray[i],i,firstFeed,lastFeed,moduleId,twitterDivId);theFeed.render()}}}};CDC.qs=function(a){if(a=="")return{};var b={};for(var i=0;i<a.length;++i){var p=a[i].split("=");if(p.length!=2)continue;b[p[0]]=decodeURIComponent(p[1].replace(/\+/g," "))}return b};CDC.SocialMedia.Feeds.Facebook=function(feedDefinitionArray,moduleId,facebookDivId){this.feedDefinitionArray=feedDefinitionArray;this.moduleId=typeof moduleId=="undefined"?CDC.SocialMedia.Feeds.SOCIAL_MEDIA_FEEDS_DIV_ID:moduleId;this.facebookDivId=typeof facebookDivId=="undefined"?CDC.SocialMedia.Feeds.FACEBOOK_DIV_ID:facebookDivId;AjaxMethod=function(feedDef,feedIndex,firstFeed,lastFeed,moduleId,facebookDivId){this.feedDef=feedDef;this.feedIndex=feedIndex;this.firstFeed=firstFeed;this.lastFeed=lastFeed;this.moduleId=moduleId;this.facebookDivId=facebookDivId;this.tagId=this.moduleId+" "+this.facebookDivId+" "};AjaxMethod.prototype={render:function(){if(this.feedDef.enabled&&$.support.ajax&&!(navigator.platform=="BlackBerry"&&navigator.appVersion.substring(0,6)=="5.0.0.")){if(this.firstFeed){$(this.tagId+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","block")}$.getJSON(CDC.SocialMedia.Feeds.FEED_URL_PREFIX+"?"+CDC.SocialMedia.Feeds.FEED_ID_PARAM+"="+this.feedDef.feedId+"&format=json&callback=?",function(fd,ti,ff,lf){return function(data){try{var newId="item-fb-"+fd.feedId;var newItem=$("#"+newId);var i=0;var numberFound=0;while(numberFound<fd.numberOfItems&&i<data.data.length){var item=data.data[i];if(typeof item.message!=="undefined"&&item.message.length>0){var rawEntry=CDC.SocialMedia.Feeds.linkify(item.message);rawEntry=rawEntry.replace(/&lt;br\/&gt;&lt;br\/&gt;/gi,"&lt;br/&gt;");rawEntry=rawEntry.replace(/onclick=&quot;.*?&quot;\);.*?return.*?\);&quot;/gi,"");rawEntry=rawEntry.replace(/onclick=&quot;.*?&quot;\);&quot;/gi,"");rawEntry=rawEntry.replace(/onmouseover=&quot;.*&?quot;\);&quot;/gi,"");if(numberFound<fd.numberOfItems-1){newItem.html(newItem.html()+'<div class="feed-item">'+$('<div style="display: none;"/>').html(rawEntry).html()+"</div>")}else{newItem.html(newItem.html()+'<div class="feed-item lastChild">'+$('<div style="display: none;"/>').html(rawEntry).html()+"</div>")}newItem.find("a").each(function(){var target=$(this).prop("href");var linkText=$(this).html();if(target.indexOf("http://"+location.host+"/profile.php?")===0||target.indexOf("https://"+location.host+"/profile.php?")===0){$(this).prop("href",target.replace(location.host,"www.facebook.com"))}else{if(target.indexOf("http://"+location.host+"/l.php?")===0||target.indexOf("https://"+location.host+"/l.php?")===0){target=decodeURIComponent(CDC.qs(target.substring(target.indexOf("?")+1).split("&"))["u"]);$(this).prop("href",target)}else{if(target.indexOf("/")===0){$(this).prop("href","https://www.facebook.com"+target)}else if(target.indexOf("/l.php?")>-1){target=decodeURIComponent(CDC.qs(target.substring(target.indexOf("?")+1).split("&"))["u"]);$(this).prop("href",target)}}}$(this).html(linkText)});newItem.find('a[title^="To tag someone"]').each(function(){$(this).prop("title",$(this).text())});newItem.find("a").filter(function(){return/(jpe?g|png|gif)$/i.test($(this).attr("href"))}).remove();numberFound++}i++}var block=$("#item-fb-profile-"+fd.feedId);block.append(newItem);$("#"+newId+" img").attr("alt","Image from Facebook").css("display","none");$("#"+newId).fadeIn(400,function(){});if(lf){$(ti+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none");$(ti+CDC.SocialMedia.Feeds.FAILOVER_ANCHOR).css("display","none")}}catch(err){if(lf){$(ti+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none");$(ti+CDC.SocialMedia.Feeds.FAILOVER_ANCHOR).css("display","block")}}}}(this.feedDef,this.tagId,this.firstFeed,this.lastFeed)).error(function(){if(this.lastFeed){$(this.tagId+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none");$(this.tagId+CDC.SocialMedia.Feeds.FAILOVER_ANCHOR).css("display","block")}})}else if(this.feedDef.enabled&&navigator.platform=="BlackBerry"&&navigator.appVersion.substring(0,6)=="5.0.0."){$(this.tagId+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none");$(this.tagId+CDC.SocialMedia.Feeds.FAILOVER_ANCHOR).css("display","block");$(this.tagId+"h4 a").css("padding-left","28px")}else{$(this.tagId+CDC.SocialMedia.Feeds.LOADER_GRAPHIC).css("display","none")}}};return{render:function(){var firstFeed=true;var lastFeed=true;var moduleId;var facebookDivId;if(typeof this.moduleId=="undefined"){moduleId="#"+CDC.SocialMedia.Feeds.SOCIAL_MEDIA_FEEDS_DIV_ID}else if(this.moduleId.substring(0,1)!="#"){moduleId="#"+this.moduleId}if(typeof this.facebookDivId=="undefined"){facebookDivId="#"+CDC.SocialMedia.Feeds.FACEBOOK_DIV_ID}else if(this.facebookDivId.substring(0,1)!="#"){facebookDivId="#"+this.facebookDivId}var tagId=moduleId+" "+facebookDivId+" ";for(var i=0;i<feedDefinitionArray.length;i++){var placeholder=$('<div id="item-fb-profile-'+feedDefinitionArray[i].feedId+'" />');$(tagId+CDC.SocialMedia.Feeds.FEED_ITEM_BLOCK).append(placeholder);var newId="item-fb-"+feedDefinitionArray[i].feedId;var block=$(tagId+CDC.SocialMedia.Feeds.FEED_ITEM_BLOCK);var newItem=$('<p id="'+newId+'" style="display: none;" />');var cdcGovHeader=$('<a class="socl-user noLinking" href="'+feedDefinitionArray[i].url+'" target="_blank">'+feedDefinitionArray[i].title+"</a>");placeholder.append(newItem);placeholder.append(cdcGovHeader)}for(var i=0;i<feedDefinitionArray.length;i++){firstFeed=i==0;lastFeed=i==feedDefinitionArray.length-1;var theFeed=new AjaxMethod(feedDefinitionArray[i],i,firstFeed,lastFeed,moduleId,facebookDivId);theFeed.render()}}}};function displayTwitterFeed(feedId,twitterUrl,title,numberOfItems,enabled,firstFeed,lastFeed,moduleId,twitterDivId){if(typeof numberOfItems=="undefined"){numberOfItems=1}if(typeof enabled=="undefined"){enabled=true}if(typeof firstFeed=="undefined"){firstFeed=true}if(typeof lastFeed=="undefined"){lastFeed=true}var twitterFeed=new CDC.SocialMedia.Feeds.Twitter([new feedDefinition(feedId,twitterUrl,title,numberOfItems,enabled)],moduleId,twitterDivId);twitterFeed.render()}function displayFacebookFeed(feedId,facebookUrl,title,numberOfItems,enabled,firstFeed,lastFeed,moduleId,facebookDivId){if(typeof numberOfItems=="undefined"){numberOfItems=1}if(typeof enabled=="undefined"){enabled=true}if(typeof firstFeed=="undefined"){firstFeed=true}if(typeof lastFeed=="undefined"){lastFeed=true}var facebookFeed=new CDC.SocialMedia.Feeds.Facebook([new feedDefinition(feedId,facebookUrl,title,numberOfItems,enabled)],moduleId,facebookDivId);facebookFeed.render()}